from rerank_algorithm.models import User
import pandas as pd
import numpy as np
import re

class Storage():

  DEFAULT_USERS = [
    {
      'name': 'read urdu books',
      'read_books': ['6736366', '184059067X', '1840590742', '1840590815', '077352763X'],
      'rated_books': [],
    },

    {
      'name': 'read 39 baking books',
      'read_books':  ['1581825048', '0399532455', '1418051438', '1416535993', '1897766637', '1569243344', '1579904610', '0618048316', '1592332617', '1579651178', '0028620666', '1571458298', '0764576453', '1585741124', '0130490555', '1569245894', '0755312112', '1583309225', '1552094936', '0471432849', '0688167241', '0060582634', '0679439773', '1579652913', '1579652107', '1853394076', '0743246829', '0312310226', '0670857238', '0747513163', '0312362919', '1855732955', '0676974112', '0070598711', '0595002765', '0852638019', '0470140100', '1878272063', '1569069913'],
      'rated_books':  ['1581825048', '0399532455', '1418051438', '1416535993', '1897766637', '1569243344', '1579904610', '0618048316', '1592332617', '1579651178', '0028620666', '1571458298', '0764576453', '1585741124', '0130490555', '1569245894', '0755312112', '1583309225', '1552094936', '0471432849', '0688167241', '0060582634', '0679439773', '1579652913', '1579652107', '1853394076', '0743246829', '0312310226', '0670857238', '0747513163', '0312362919', '1855732955', '0676974112', '0070598711', '0595002765', '0852638019', '0470140100', '1878272063', '1569069913'],
    },

    {
      'name': 'read 39 vampire books',
      'read_books': ['0425217167', '0425209768', '0195115937', '0786016159', '038089808X', '157859071X', '0441859461', '0441847765', '0517165929', '0441859453', '0843948507', '0007117981', '0895980517', '0440403294', '0345492536', '0821766929', '0441014674', '0345492552', '0575402725', '142410436X', '1555835864', '0553714163', '0425140601', '0060502223', '0312948603', '1402208456', '1416522263', '0743427122', '1598169246', '1598163264', '159816922X', '1573440159', '1573442526', '0006751113', '006134088X', '0590104675', '068985918X', '0573608229', '155583843X'],
      'rated_books': ['0425217167', '0425209768', '0195115937', '0786016159', '038089808X', '157859071X', '0441859461', '0441847765', '0517165929', '0441859453', '0843948507', '0007117981', '0895980517', '0440403294', '0345492536', '0821766929', '0441014674', '0345492552', '0575402725', '142410436X', '1555835864', '0553714163', '0425140601', '0060502223', '0312948603', '1402208456', '1416522263', '0743427122', '1598169246', '1598163264', '159816922X', '1573440159', '1573442526', '0006751113', '006134088X', '0590104675', '068985918X', '0573608229', '155583843X'],
    }
  ]

  def __init__(self):
    self.users = {}

  def store_stats(self):
    return self.users

  def set_user(self, username):
    nextID = len(self.users) +1
    userData = {
      'name': username,
      'data': User(name=username),
      'read_books': [],
      'rated_books': [],
    }
    self.users[nextID] = userData

    return nextID

  def get_user_by_id(self, userID):
    return self.users[userID]

if __name__ == "__main__":
  data = ["../data/book600k-700k.csv", "../data/book700k-800k.csv", "../data/book800k-900k.csv", "../data/book900k-1000k.csv", "../data/book1000k-1100k.csv"]
  d1 = np.array([])
  d2 = np.array([])
  for fp in data:
    df = pd.read_csv(fp)
    d1 = np.concatenate((d1, df[df['Name'].str.match('.*[bB]aking.*')]['ISBN'].dropna().ravel()))
    d2 = np.concatenate((d2, df[df['Name'].str.match('.*[vV]ampire.*')]['ISBN'].dropna().ravel()))
  print('baking', d1)
  print('vampire', d2[:39])
  print(d1.shape, d2.shape)